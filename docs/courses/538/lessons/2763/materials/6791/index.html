<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Учебник | Библиотеки Python. Морфология </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/material.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="lesson-material">
		<div class="layout">
			<div class="layout__wrapper layout__wrapper_type_narrow layout__wrapper_fixed">
				<main class="layout__main">
					<div class="lesson-material__wrapper">
						<a class="nav-tab nav-tab_back nav-tab_view_button" href="../..">
						<span data-lego="react"
						      class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span>
							<span class="nav-tab__inner">Урок Библиотеки №4</span>
						</a>
						<section class="lesson-material__content">
							<article class="material"><h1>Библиотеки Python. Часть 4. Морфология</h1>
<section class="material__plan"><nav>
<ol>
<li><a class="material__link" href="#1">Библиотека pymorphy2</a></li>
<li><a class="material__link" href="#2">Морфологический анализ</a></li>
<li><a class="material__link" href="#3">Работа с&nbsp;тегами</a></li>
<li><a class="material__link" href="#4">Постановка слов в&nbsp;начальную форму</a></li>
<li><a class="material__link" href="#5">Согласование с&nbsp;числительными</a></li>
<li><a class="material__link" href="#6">Итоги</a></li>
</ol>
</nav></section>
<section class="material__annotation">
<h2>Аннотация</h2>
<p>Мы&nbsp;уже говорили, что в&nbsp;Python имеется множество библиотек, реализующих абстракции для различных предметных областей. Поэтому мы&nbsp;занимаемся в&nbsp;основном верхним &laquo;этажом&raquo; логики. Сегодня речь пойдет о&nbsp;библиотеке, позволяющей работать с&nbsp;текстами.</p>
</section>
<section class="material__chapter">
<h2 id="1">Библиотека pymorphy2</h2>
<p>Вы&nbsp;уже знаете стандартные строковые функции и&nbsp;пользовались ими. Мы&nbsp;умеем работать со&nbsp;строками посимвольно и&nbsp;знаем, как представляется текстовая информация. Давайте перейдем на&nbsp;уровень выше. Строка и&nbsp;текст в&nbsp;общем случае состоят не&nbsp;из&nbsp;набора букв, а&nbsp;из&nbsp;слов, и&nbsp;иногда нужно работать именно со&nbsp;словами, а&nbsp;не&nbsp;просто с&nbsp;последовательностями байтов.</p>
<div class="material__content-positioner"><img class="material__illustration" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-28/16.svg" width="680" height="auto" /></div>
<p>Возьмем для примера склонение существительных с&nbsp;числительными. Например, на&nbsp;форуме надо написать, что в&nbsp;теме &laquo;21&nbsp;комментарий&raquo;, но&nbsp;&laquo;24&nbsp;комментария&raquo;. То&nbsp;же самое нужно делать и&nbsp;для других слов: например, &laquo;новость&raquo;, &laquo;пользователь&raquo;. Иногда на&nbsp;сайтах обходят эту проблему и&nbsp;вставляют машинное &laquo;комментариев: 21&raquo;.</p>
<p>Давайте посмотрим, какие средства работы со&nbsp;словами есть в&nbsp;Python, и&nbsp;познакомимся с&nbsp;библиотекой pymorphy2 (морфология).</p>
<p>Если эта библиотека отсутствует в&nbsp;вашем Python, ее&nbsp;надо установить с&nbsp;помощью утилиты pip.</p>
<pre><code>pip install pymorphy2
</code></pre>
<p>Словари распространяются отдельными пакетами. Для русского языка используется pymorphy2-dicts-ru.</p>
<p>Они обновляются время от&nbsp;времени, для обновления используйте команду</p>
<pre><code>pip install -U pymorphy2-dicts-ru
</code></pre>
</section>
<section class="material__chapter">
<h2 id="2">Морфологический анализ</h2>
<p>В&nbsp;pymorphy2 для морфологического анализа слов есть класс <var>MorphAnalyzer</var>.</p>
<section class="material__note">
<p class="material__note-heading"><strong>Морфологический анализ</strong></p>
<p>Морфологический анализ&nbsp;&mdash; определение характеристик слова на&nbsp;основе того, как оно пишется. При морфологическом анализе не&nbsp;учитываются соседние слова.</p>
<p>Для любого слова библиотека делает несколько предположений, что оно может означать, и&nbsp;обозначает свою уверенность в&nbsp;этом предположении.</p>
</section>
<p>Метод <code>MorphAnalyzer.parse()</code> возвращает один или несколько объектов типа <var>Parse</var> с&nbsp;информацией о&nbsp;том, как слово может быть разобрано.</p>
<pre><code class="language-python">import pymorphy2
morph = pymorphy2.MorphAnalyzer()

morph.parse('Ваня')
</code></pre>
<pre><samp>[Parse(word='ваня', tag=OpencorporaTag('NOUN,anim,masc,Name sing,nomn'), 
       normal_form='ваня', score=1.0, 
       methods_stack=((&lt;DictionaryAnalyzer&gt;, 'ваня', 407, 0),))]</samp></pre>
<p>В&nbsp;данном случае предположение одно с&nbsp;уверенностью score=1.0. Итак, мы&nbsp;имеем дело с&nbsp;существительным NOUN, именем собственным, одушевленным, мужского рода.</p>
<p>Конечно, предположений может быть несколько:</p>
<pre><code class="language-python">import pymorphy2
import pprint

morph = pymorphy2.MorphAnalyzer()
res = morph.parse('пила')
print(len(res))
pprint.pprint(res)
</code></pre>
<pre><samp>4
[Parse(word='пила', tag=OpencorporaTag('NOUN,inan,femn sing,nomn'), 
       normal_form='пила', score=0.428571, 
       methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 55, 0),)),
 Parse(word='пила', tag=OpencorporaTag('VERB,impf,tran femn,sing,past,indc'), 
       normal_form='пить', score=0.285714, 
       methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 444, 8),)),
 Parse(word='пила', tag=OpencorporaTag('NOUN,anim,masc,Name sing,gent'), 
       normal_form='пил', score=0.142857, 
       methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 1124, 1),)),
 Parse(word='пила', tag=OpencorporaTag('NOUN,anim,masc,Name sing,accs'), 
       normal_form='пил', score=0.142857, 
       methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 1124, 3),))]</samp></pre>
<p>У&nbsp;каждого разбора есть тег:</p>
<pre><code class="language-python">p = morph.parse('пила')[1]
print(p)
</code></pre>
<pre><samp>Parse(word='пила', tag=OpencorporaTag('VERB,impf,tran femn,sing,past,indc'), 
      normal_form='пить', score=0.285714, 
      methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 444, 8),))</samp></pre>
<section class="material__note">
<p class="material__note-heading"><strong>Тег</strong></p>
<p>Тег&nbsp;&mdash; набор граммем (грамматических признаков), характеризующих данное слово.</p>
<p>Например, тег <code>'VERB,impf, tran femn, sing,past,indc'</code> означает, что слово&nbsp;&mdash; глагол (VERB) несовершенного вида (impf), переходный (tran), женского рода (femn), единственного числа (sing), прошедшего времени (past), изъявительного наклонения (indc).</p>
<p>Полный список граммем (грамматических единиц) можно посмотреть <span style="text-decoration: underline; color: #0000ff;"><a class="material__link" style="color: #0000ff; text-decoration: underline;" href="http://opencorpora.org/dict.php?act=gram" target="_blank" rel="noopener noreferrer">тут</a></span> и&nbsp;<span style="text-decoration: underline; color: #0000ff;"><a class="material__link" style="color: #0000ff; text-decoration: underline;" href="https://pymorphy2.readthedocs.io/en/latest/user/grammemes.html#grammeme-docs" target="_blank" rel="noopener noreferrer">тут</a></span>.</p>
</section>
</section>
<section class="material__chapter">
<h2 id="3">Работа с&nbsp;тегами</h2>
<p>Чтобы проверить, есть&nbsp;ли в&nbsp;данном теге отдельная граммема (или все граммемы из&nbsp;указанного множества), используйте оператор&nbsp;<var>in</var>:</p>
<pre><code class="language-python">'NOUN' in p.tag # =&gt; False
</code></pre>
<p>Пример:</p>
<pre><code class="language-python">import pymorphy2

morph = pymorphy2.MorphAnalyzer()
res = morph.parse('питона')[1] 
# В нулевом предположении будет родительный падеж - он чаще встречается
# проверка на глагол
print("VERB" in res.tag)
# проверка на винительный падеж
print("accs" in res.tag)
# cуществительное в винительном падеже?
print({"NOUN", 'accs'} in res.tag)
</code></pre>
<pre><samp>False
True
True</samp></pre>
<p>Кроме того, у&nbsp;каждого тега есть атрибуты, через которые можно получить часть речи, число и&nbsp;другие характеристики:</p>
<section class="material__note">
<p class="material__note-heading"><strong>Например, для глагола бывают теги:</strong></p>
<pre><code class="language-python">p.tag.POS           # часть речи
p.tag.animacy       # одушевленность
p.tag.aspect        # вид: совершенный или несовершенный
p.tag.gender        # род (мужской, женский, средний)
p.tag.involvement   # включенность говорящего в действие
p.tag.mood          # наклонение (повелительное, изъявительное)
p.tag.number        # число (единственное, множественное)
p.tag.person        # лицо (1, 2, 3)
p.tag.tense         # время (настоящее, прошедшее, будущее)
p.tag.transitivity  # переходность (переходный, непереходный)
p.tag.voice         # залог (действительный, страдательный)
</code></pre>
</section>
<p>Если мы&nbsp;попытаемся получить доступ к&nbsp;граммеме, которой нет для слова данной части речи, получим None.</p>
<pre><code class="language-python">import pymorphy2

morph = pymorphy2.MorphAnalyzer()
res = morph.parse('писал')[0]
print(res.tag.mood)
print(res.tag.tense)
# попытка доступа к граммеме, которой нет для этой части речи
print(res.tag.case)
</code></pre>
<pre><samp>indc
past
None</samp></pre>
<p>Итак, мы&nbsp;можем разбирать большие тексты на&nbsp;части и&nbsp;узнавать информацию о&nbsp;словах: например, искать глаголы, подсчитывать имена и&nbsp;т.&nbsp;д.</p>
<p>Для изменения слов (к примеру, склонения существительных) можно использовать метод <var>inflect</var>:</p>
<pre><code class="language-python">word = morph.parse('случай')[0]
print(word.inflect({'gent'})) 
</code></pre>
<pre><samp>Parse(word='случая', tag=OpencorporaTag('NOUN,inan,masc sing,gent'), 
      normal_form='случай', score=1.0, 
      methods_stack=((&lt;DictionaryAnalyzer&gt;, 'случая', 175, 1),))</samp></pre>
<p>И&nbsp;во&nbsp;множественном числе:</p>
<pre><code class="language-python">print(word.inflect({'gent', 'plur'})) 
</code></pre>
<pre><samp>Parse(word='случаев', tag=OpencorporaTag('NOUN,inan,masc plur,gent'), 
      normal_form='случай', score=1.0, 
      methods_stack=((&lt;DictionaryAnalyzer&gt;, 'случаев', 175, 7),))</samp></pre>
<p>Метод <var>inflect</var> работает и&nbsp;с&nbsp;другими частями речи&nbsp;&mdash; например, глаголами:</p>
<pre><code class="language-python">word = morph.parse('программировать')[0]
print(word.inflect({'VERB', 'impf', 'masc', 'sing', 'past', 'indc'}))
</code></pre>
<pre><samp>Parse(word='программировал', tag=OpencorporaTag('VERB,impf,tran masc,sing,past,indc'), 
      normal_form='программировать', score=1.0, 
      methods_stack=((&lt;DictionaryAnalyzer&gt;, 'программировал', 168, 7),))</samp></pre>
<p>Вернемся к&nbsp;параметру <var>score</var>.</p>
<pre><code class="language-python">morph.parse('пила')
# =&gt; [Parse(word='пила', tag=OpencorporaTag('NOUN,inan,femn sing,nomn'), 
# normal_form='пила', score=0.428571, 
# methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 55, 0),)),

# =&gt; Parse(word='пила', tag=OpencorporaTag('VERB,impf,tran femn,sing,past,indc'), 
# normal_form='пить', score=0.285714, 
# methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 444, 8),)),

# =&gt; Parse(word='пила', tag=OpencorporaTag('NOUN,anim,masc,Name sing,gent'), 
# normal_form='пил', score=0.142857, 
# methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 1124, 1),)),

# =&gt; Parse(word='пила', tag=OpencorporaTag('NOUN,anim,masc,Name sing,accs'), 
# normal_form='пил', score=0.142857, 
# methods_stack=((&lt;DictionaryAnalyzer&gt;, 'пила', 1124, 3),))]
</code></pre>
<p>Мы&nbsp;видим, что предложенные четыре варианта разбора имеют параметр <var>score</var>, который говорит нам о&nbsp;том, какой вариант предпочтительнее. Pymorphy2 использует статистические методы и&nbsp;ориентируется на&nbsp;данные проекта <span style="text-decoration: underline; color: #0000ff;"><a class="material__link" style="color: #0000ff; text-decoration: underline;" href="http://opencorpora.org/" target="_blank" rel="noopener noreferrer">OpenCorpora</a></span>, чтобы вычислить значение параметра <var>score</var>. Мы&nbsp;не&nbsp;будем останавливаться на&nbsp;этом подробно. Интересующиеся могут прочитать о&nbsp;внутренней кухне на&nbsp;странице документации по&nbsp;Pymorphy2. Скажем только, что эти вычисления не&nbsp;всегда точны.</p>
<p>Разборы сортируются по&nbsp;убыванию <var>score</var>, поэтому почти везде в&nbsp;примерах берется первый вариант разбора из&nbsp;возможных (например, <code>morph.parse('пила')[0]</code>).</p>
</section>
<section class="material__chapter">
<h2 id="4">Постановка слов в&nbsp;начальную форму</h2>
<p>Нормальную (начальную) форму слова можно получить через атрибуты <var>Parse.normal_form</var> и&nbsp;<var>Parse.normalized</var>. Например, для глаголов в&nbsp;нем будет храниться инфинитив. Таким образом, можно привести любую форму глагола к&nbsp;единому виду.</p>
<p>Но&nbsp;что считается за&nbsp;нормальную форму у&nbsp;других слов? Например, возьмем слово &laquo;изучающим&raquo;. Иногда мы&nbsp;захотим нормализовать его в&nbsp;&laquo;изучать&raquo;, иногда&nbsp;&mdash; в&nbsp;&laquo;изучающий&raquo;, иногда&nbsp;&mdash; в&nbsp;&laquo;изучающая&raquo;.</p>
<p>Посмотрим на&nbsp;примере, что сделает pymorphy2:</p>
<pre><code class="language-python">morph.parse('изучающим')[0].normal_form
# =&gt; 'изучать'
</code></pre>
<p>Pymorphy2 сейчас использует алгоритм нахождения нормальной формы, который работает наиболее быстро (берется первая форма в&nbsp;лексеме)&nbsp;&mdash; именно поэтому, например, все причастия сейчас нормализуются в&nbsp;инфинитивы. Это можно считать деталью реализации.</p>
<p>Если требуется нормализовать слова иначе, можно воспользоваться методом <code>Parse.inflect()</code>:</p>
<pre><code class="language-python">morph.parse('изучающим')[0].inflect({'sing', 'nomn'}).word
# =&gt; 'изучающий'
</code></pre>
</section>
<section class="material__chapter">
<h2 id="5">Согласование с&nbsp;числительными</h2>
<p>Помимо разбора слов, библиотека может их&nbsp;изменять&nbsp;&mdash; например, сопоставлять с&nbsp;числами. Давайте посмотрим, как можно решить задачу с&nbsp;подсчетом и&nbsp;выводом количества комментариев на&nbsp;форуме:</p>
<pre><code class="language-python">comment = morph.parse('комментарий')[0]
comment.make_agree_with_number(1).word # =&gt; 'комментарий'
comment.make_agree_with_number(2).word # =&gt; 'комментария'
comment.make_agree_with_number(7).word # =&gt; 'комментариев'
</code></pre>
<section class="material__note">
<p class="material__note-heading"><strong>Важно!</strong></p>
<p>Интересно, что библиотека пытается работать даже со&nbsp;словами, которых не&nbsp;знает, обращаясь к&nbsp;<em>оракулу</em>:</p>
<pre><code class="language-python">word = morph.parse('Мегатрон')[0]
word.make_agree_with_number(7).word # =&gt; 'мегатронов'
word.make_agree_with_number(2).word # =&gt; 'мегатрона'
</code></pre>
</section>
</section>
<section class="material__chapter">
<h2 id="6">Итоги</h2>
<p>Мы&nbsp;выяснили, что работа со&nbsp;словами в&nbsp;Python довольно проста. Сторонние библиотеки позволяют упростить работу с&nbsp;морфологией языков.</p>
<p>Мы&nbsp;не&nbsp;рассматривали средства и&nbsp;библиотеки для извлечения знаний и&nbsp;фактов из&nbsp;текстов на&nbsp;естественных языках. Например, по&nbsp;тексту новости (цитируется портал lenta.ru):</p>
<p><em>Россиянка Дарья Виролайнен досрочно стала обладательницей Большого Хрустального глобуса, вручаемого победительнице общего зачета Кубка Международного союза биатлонистов (IBU). Об&nbsp;этом сообщается на&nbsp;<span style="text-decoration: underline; color: #0000ff;"><a class="material__link" style="color: #0000ff; text-decoration: underline;" href="http://www.biathlonworld.com/news/detail/alexander-loginov-wins-ibu-cup-pursuit" target="_blank" rel="noopener noreferrer">OpenCorpora</a></span> IBU.</em></p>
<p><em>На&nbsp;всех этапах Виролайнен набрала 684&nbsp;очка, ее&nbsp;соотечественница Анна Никулина, идущая второй,&nbsp;&mdash; 526&nbsp;баллов. На&nbsp;последнем этапе Кубка IBU в&nbsp;Эстонии россиянка не&nbsp;выступит: она вызвана в&nbsp;основной состав сборной России на&nbsp;этап Кубка мира. Тем не&nbsp;менее, Никулина не&nbsp;сумеет догнать&nbsp;ее.</em></p>
<p><em>Виролайнен стала обладательницей и Малого Хрустального глобуса в&nbsp;зачете гонок преследования.</em></p>
<p><em>На&nbsp;чемпионате мира по&nbsp;биатлону, прошедшем с&nbsp;8&nbsp;по&nbsp;19&nbsp;февраля в&nbsp;австрийском Хохфильцене, спортсменка была в&nbsp;составе сборной России, однако не&nbsp;провела ни&nbsp;одной гонки.</em></p>
<p>Можно узнать, что речь идет о&nbsp;конкретном человеке, странах и&nbsp;датах, что тут упоминается вид спорта и&nbsp;т.&nbsp;д. Со&nbsp;временем вы&nbsp;усвоите и&nbsp;эти возможности библиотек Python.</p>
</section></article>
						</section>
					</div>
				</main>
			</div>
		</div>
<footer class="footer">
	<div class="footer__controls">
		<a rel="noopener noreferrer" target="_blank" class="footer__help-link"
		   href="https://yandex.ru/legal/lms_termsofuse/">Terms of use</a>
	</div>
	<div class="footer__copyright">
		<div>
			<div class="Markdown">
				<div class="paragraph">Generated by <a rel="noopener noreferrer" target="_blank"
				                                       class="footer__help-link"
				                                       href="https://github.com/rodion-gudz/YandexLyceumDocs">Yandex Lyceum Docs</a>
				</div>
			</div>
		</div>
	</div>
</footer>	</div>
	<script src="/js/prism.js"></script>
</body>
</html>