<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Учебник | Библиотеки Python. Работа с документами </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/material.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="lesson-material">
		<div class="layout">
			<div class="layout__wrapper layout__wrapper_type_narrow layout__wrapper_fixed">
				<main class="layout__main">
					<div class="lesson-material__wrapper">
						<a class="nav-tab nav-tab_back nav-tab_view_button" href="../..">
						<span data-lego="react"
						      class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span>
							<span class="nav-tab__inner">Урок Библиотеки №5</span>
						</a>
						<section class="lesson-material__content">
							<article class="material"><h1>Библиотеки Python. Часть 5. Документы</h1>
<section class="material__plan"><nav>
<ol>
<li><a class="material__link" href="#1">Работа с&nbsp;документами</a></li>
<li><a class="material__link" href="#2">Создание текстового документа</a></li>
<li><a class="material__link" href="#3">Работа с&nbsp;документом как с&nbsp;шаблоном</a></li>
<li><a class="material__link" href="#4">Создание презентаций</a></li>
<li><a class="material__link" href="#5">Создание таблиц Excel</a></li>
</ol>
</nav></section>
<section class="material__annotation">
<h2>Аннотация</h2>
<p>Сегодня мы&nbsp;поговорим о&nbsp;библиотеках по&nbsp;работе с&nbsp;документами (текстами, презентациями, таблицами). Эти библиотеки можно использовать для автоматизации документооборота. Например, можно формировать документы: макеты презентаций, налоговую отчетность, открытки с&nbsp;поздравлениями.</p>
</section>
<section class="material__chapter">
<h2 id="1">Работа с&nbsp;документами</h2>
<p>Довольно часто при разработке возникает необходимость программно создать какой-то документ или внести изменения в&nbsp;уже существующий. Работая с&nbsp;текстами разной направленности из&nbsp;кода, нужно принять во&nbsp;внимание, что тексты иногда хранятся в&nbsp;более сложных форматах, чем .txt. Они могут содержать встроенное форматирование, быть разделенными на&nbsp;страницы, перемежаться медиаконтентом (графиками, рисунками).</p>
<p>Python умеет работать со&nbsp;многими такими документами. Давайте посмотрим, что можно сделать, чтобы создавать документы в&nbsp;формате Word, Excel или PowerPoint прямо из&nbsp;Python.</p>
<p>Стоит отметить, что форматы .docx, .xlsx и .pptx открытые, что позволяет разработчикам довольно просто писать библиотеки для работы с&nbsp;ними. Для каждого офисного формата есть несколько библиотек с&nbsp;разным функционалом, и&nbsp;мы&nbsp;рассмотрим лишь некоторые из&nbsp;них.</p>
<div class="material__content-positioner"><img class="material__illustration" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/17.svg" width="680" height="auto" /></div>
</section>
<section class="material__chapter">
<h2 id="2">Создание текстового документа</h2>
<p>Давайте воспользуемся модулем python-docx для создания docx-документа. Он, как и&nbsp;остальные приведенные в&nbsp;данном уроке библиотеки, не&nbsp;входит в&nbsp;состав стандартной библиотеки и&nbsp;требует отдельной установки через pip.</p>
<pre><code>pip install python-docx
</code></pre>
<p>После установки давайте рассмотрим вот такой пример:</p>
<pre><code class="language-python">from docx import Document
from docx.shared import Inches

document = Document()

document.add_heading('Заголовок документа', 0)

document.add_paragraph('Абзац без форматирования')

# тут у нас будет более сложный абзац
p = document.add_paragraph('Часть абзаца обычным текстом, ')
p.add_run('часть жирным шрифтом, ').bold = True
p.add_run(' а часть ')
p.add_run('курсивом.').italic = True

document.add_heading('Заголовок первого уровня', level=1)
document.add_paragraph('Некоторая цитата', style='Intense Quote')

document.add_paragraph('Элемент ненумерованного списка', 
                       style='List Bullet')
document.add_paragraph('Элемент нумерованного списка', 
                       style='List Number')

table = document.add_table(rows=1, cols=3)
hdr_cells = table.rows[0].cells
hdr_cells[0].text = 'Номер'
hdr_cells[1].text = 'Название'
hdr_cells[2].text = 'Количество'

document.save('test.docx')
</code></pre>
<p>Ключевой элемент этой библиотеки&nbsp;&mdash; объект <var>Document</var>. Для создания нового документа формата .docx надо записать результат вызова <var>Document</var> в&nbsp;переменную. Этого достаточно для создания абсолютно пустого документа в&nbsp;памяти. Чтобы наполнить его содержимым, необходимо вызывать у&nbsp;получившегося объекта различные методы, например:</p>
<ul>
<li><var>add_heading</var>&nbsp;&mdash; для создания заголовков разного уровня. При этом уровень 0&nbsp;&mdash; заголовок документа</li>
<li><var>add_paragraph</var>&nbsp;&mdash; для создания абзацев. С&nbsp;помощью параметра <var>style</var> можно управлять стилем абзаца и&nbsp;превращать его элемент маркированного или нумерованного списка</li>
</ul>
<p>Метод <var>add_paragraph</var> объекта-документа возвращает новый абзац, у&nbsp;которого есть свои методы вроде <var>add_run</var>, который дописывает текст с&nbsp;форматированием или без него в&nbsp;конец абзаца.</p>
<p>Метод <var>add_table</var> создает в&nbsp;документе таблицу размером <var>col</var> столбцов и&nbsp;<var>row</var> строк. Если мы&nbsp;присвоим результат вызова этой функции переменной, сможем заполнить такую таблицу данными.</p>
<p>Метод <var>save</var> сохраняет документ под указанным именем.</p>
<p>Выполните приведенный код. Затем откройте созданный файл test.docx. Вы&nbsp;должны увидеть что-то такое:</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-docx-1.png" width="680" height="auto" /></div>
<p>С&nbsp;помощью python-docx можно не&nbsp;только создавать новые документы, но&nbsp;и&nbsp;открывать уже существующие. Для этого при создании документа надо в&nbsp;качестве параметра передать путь к&nbsp;файлу или просто его имя, если он&nbsp;находится в&nbsp;каталоге с&nbsp;программой.</p>
<p>Таким образом, мы&nbsp;можем получить абзацы или другие элементы документа, пройтись по&nbsp;ним и&nbsp;получить либо изменить какую-то информацию:</p>
<pre><code class="language-python">from docx import Document

document = Document('test.docx')
for par in document.paragraphs:
    print(par.text)

for table in document.tables:
    print(table.rows[0].cells[0].text)
</code></pre>
<pre><samp>Заголовок документа
Абзац без форматирования
Часть абзаца обычным текстом, часть жирным шрифтом,  а часть курсивом.
Заголовок первого уровня
Некоторая цитата
Элемент ненумерованного списка
Элемент нумерованного списка
Номер</samp></pre>
<p>Как мы&nbsp;увидим дальше, работа с&nbsp;подобными модулями примерно одинакова. Все элементы управления и&nbsp;форматирования:</p>
<ul>
<li>Списки</li>
<li>Абзацы</li>
<li>Таблицы</li>
<li>Ячейки</li>
</ul>
<p>есть в&nbsp;наличии в&nbsp;том или ином виде, их&nbsp;можно изменять и&nbsp;комбинировать.</p>
</section>
<section class="material__chapter">
<h2 id="3">Работа с&nbsp;документом как с&nbsp;шаблоном</h2>
<p>Очень распространенным вариантом использования является не&nbsp;создание документа с&nbsp;нуля, а&nbsp;заполнение данными уже готового шаблона. Для этого можно использовать библиотеку docxtpl.</p>
<pre><code>pip install docxtpl
</code></pre>
<p>Например, у&nbsp;нас есть вот такой шаблон приглашения на&nbsp;мероприятие:</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-docx-2.png" width="680" height="auto" /></div>
<p>C&nbsp;помощью двойных фигурных скобок выделены места в&nbsp;документе, куда мы&nbsp;можем подставить свои данные по&nbsp;имени. Кроме того, шаблоны поддерживают специальный синтаксис для циклов, условий и&nbsp;других конструкций. Внутри docxtpl лежит мощный и&nbsp;простой в&nbsp;использовании движок шаблонов jinja2. Вы&nbsp;с&nbsp;ним еще встретитесь на&nbsp;втором году обучения, когда мы&nbsp;будем говорить о&nbsp;веб-программировании.</p>
<pre><code class="language-python">from docxtpl import DocxTemplate
import datetime as dt

doc = DocxTemplate("tpl.docx")
context = {
    'name': 'Иван Иванович',
    'event_name': "танцевально-увеселительное мероприятие по случаю 45-летия независимости Кабо-Верде",
    'place': "любой точке Кабо-Верде",
    'date': dt.date.today(),
    'time': dt.datetime.now().strftime("%H:%M"),
    'items': ["картину",
              'корзину',
              "картонку",
              "маленькую собачонку"]
}
doc.render(context)
doc.save("res.docx")
</code></pre>
<p>При работе с&nbsp;этой библиотекой нам надо воспользоваться классом <var>DocxTemplate</var>, при создании экземпляра которого необходимо передать имя нашего документа, который содержит шаблон. После чего нужно создать словарь и&nbsp;заполнить его информацией для вставки в&nbsp;документ. Значения из&nbsp;нашего словаря будут подставляться в&nbsp;шаблон по&nbsp;ключу. Метод <var>render</var> как раз и&nbsp;отвечает за&nbsp;такое заполнение. Метод <var>save</var> сохраняет документ под переданным именем.</p>
<p>В&nbsp;итоге у&nbsp;нас получится вот такой документ:</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-docx-3.png" width="680" height="auto" /></div>
</section>
<section class="material__chapter">
<h2 id="4">Создание презентаций</h2>
<p>Для работы с&nbsp;презентациями формата .pptx в&nbsp;Python есть библиотека python-pptx.</p>
<pre><code>pip install python-pptx
</code></pre>
<p>Принцип ее&nbsp;работы во&nbsp;многом схож с&nbsp;библиотекой python-docx, но&nbsp;здесь ключевым элементом, с&nbsp;которым идет работа, выступает не <var>Document</var>, а <var>Presentation</var>.</p>
<p>Напишем следующий код:</p>
<pre><code class="language-python">from pptx import Presentation
# создаем новую презентацию
prs = Presentation()
# получаем схему расположения элементов для заголовочного слайда
title_slide_layout = prs.slide_layouts[0]
# создаем заголовочный слайд
slide = prs.slides.add_slide(title_slide_layout)
# создаем у слайда заголовок и текст
title = slide.shapes.title
print("Контейнер для текста:", slide.placeholders[1])
subtitle = slide.placeholders[1]

title.text = "Тестовый заголовок"
subtitle.text = "Тестовый текст"
# создаем новый слайд со схемой для добавления изображений
slide = prs.slides.add_slide(prs.slide_layouts[8])
slide.shapes.title.text = "А теперь с картинкой"
# добавляем изображение
print("Контейнер для изображения:", slide.placeholders[1])
placeholder = slide.placeholders[1]
placeholder.insert_picture('1jpg.jpg')
# сохраняем презентацию
prs.save('test.pptx')
</code></pre>
<pre><samp>Контейнер для текста: &lt;pptx.shapes.placeholder.SlidePlaceholder object at 0x05DCF3B0&gt;
Контейнер для изображения: &lt;pptx.shapes.placeholder.PicturePlaceholder object at 0x014324D0&gt;</samp></pre>
<p>Обратиться к&nbsp;слайдам презентации можно через атрибут <var>slides</var> презентации. В&nbsp;свою очередь у&nbsp;<var>slides</var> есть метод <var>add_slide</var>, который добавляет новый слайд в&nbsp;презентацию. Данный метод принимает на&nbsp;вход схему нового слайда. Подробнее о&nbsp;схемах слайдов смотрите в&nbsp;документации. Но, например, нулевая схема предназначена для создания заголовочного слайда, а&nbsp;восьмая&nbsp;&mdash; для слайда с&nbsp;изображением.</p>
<p>На&nbsp;слайде, в&nbsp;зависимости от&nbsp;схемы, по&nbsp;которой он&nbsp;создан, могут быть разные контейнеры для содержимого, которые называются <var>placeholders</var>. Бывают контейнеры для текста, изображения, таблицы или графика. У&nbsp;текстового контейнера <var>SlidePlaceholder</var> есть свойство <var>text</var>, которое задает текст.</p>
<p>У&nbsp;контейнера для изображения <var>PicturePlaceholder</var> есть метод <var>insert_picture</var>, который добавляет переданное изображение на&nbsp;слайд.</p>
<p>Метод <var>save</var> презентации сохраняет презентацию под переданным именем.</p>
<p>Вот такая презентация у&nbsp;нас получится в&nbsp;итоге:</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-pptx.png" width="404" height="auto" /></div>
<p>Как и&nbsp;в&nbsp;случае с&nbsp;документами, мы&nbsp;можем открыть уже существующую презентацию и&nbsp;получить или изменить какие-либо данные.</p>
<pre><code class="language-python">from pptx import Presentation

prs = Presentation('test.pptx')

slide = prs.slides[0]
print(slide.placeholders[0].text)
</code></pre>
<pre><samp>Тестовый заголовок</samp></pre>
</section>
<section class="material__chapter">
<h2 id="5">Создание таблиц Excel</h2>
<p>Для работы с&nbsp;файлами формата .xlsx есть несколько библиотек, одна из&nbsp;них&nbsp;&mdash; xlsxwriter, предназначенная только для создания xlsx-файлов.</p>
<pre><code>pip install xlsxwriter
</code></pre>
<p>Принцип работы с&nbsp;этой библиотекой очень схож с&nbsp;рассмотренными ранее, но&nbsp;с&nbsp;небольшими оговоркамии. Уже при создании документа нам необходимо передавать имя, под которым этот документ будет сохранен в&nbsp;конце.</p>
<pre><code class="language-python">import xlsxwriter
  
workbook = xlsxwriter.Workbook('Суммы.xlsx')
worksheet = workbook.add_worksheet()
 
data = [('Развлечения', 6800), ('Продукты', 25670), ('Транспорт', 3450),]
  
for row, (item, price) in enumerate(data):
    worksheet.write(row, 0, item)
    worksheet.write(row, 1, price)
 
row += 1
worksheet.write(row, 0, 'Всего')
worksheet.write(row, 1, '=SUM(B1:B3)')
 
workbook.close()
</code></pre>
<p>Потом с&nbsp;помощью метода <var>add_worksheet</var> надо добавить страницу в&nbsp;документ. У&nbsp;добавленной страницы можно вызывать метод <var>write</var>, который записывает в&nbsp;определенную строку и&nbsp;колонку переданные данные.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-xlsx-1.png" width="637" height="auto" /></div>
<p>С&nbsp;помощью метода <var>add_chart</var> можно создать диаграмму, указав ее&nbsp;тип и&nbsp;данные для построения. После чего построенную диаграмму можно добавить на&nbsp;страницу с&nbsp;помощью метода <var>insert_chart</var> с&nbsp;указанием ячейки вставки и&nbsp;самой диаграммы.</p>
<pre><code class="language-python">import xlsxwriter
 
workbook = xlsxwriter.Workbook('диаграммы.xlsx')
worksheet = workbook.add_worksheet()
 
# Данные
data = [10, 40, 50, 20, 10, 50, 20]
worksheet.write_column('A1', data)
 
# Тип диаграммы
chart = workbook.add_chart({'type': 'line'})
 
# Строим по нашим данным
chart.add_series({'values': '=Sheet1!A1:A7'})
 
worksheet.insert_chart('C1', chart)
workbook.close()
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/first-year/lesson-29/lesson-29-xlsx-2.png" width="680" height="auto" /></div>
<p>С&nbsp;помощью библиотеки openpyxl можно как создавать, так и&nbsp;читать и&nbsp;редактировать файлы формата .xlsx. Рассмотрите примеры использования этой библиотеки самостоятельно.</p>
</section></article>
						</section>
					</div>
				</main>
			</div>
		</div>
<footer class="footer">
	<div class="footer__controls">
		<a rel="noopener noreferrer" target="_blank" class="footer__help-link"
		   href="https://yandex.ru/legal/lms_termsofuse/">Terms of use</a>
	</div>
	<div class="footer__copyright">
		<div>
			<div class="Markdown">
				<div class="paragraph">Generated by <a rel="noopener noreferrer" target="_blank"
				                                       class="footer__help-link"
				                                       href="https://github.com/rodion-gudz/YandexLyceumDocs">Yandex Lyceum Docs</a>
				</div>
			</div>
		</div>
	</div>
</footer>	</div>
	<script src="/js/prism.js"></script>
</body>
</html>