<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Учебник | Разворачиваем проект в облаке </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/material.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="lesson-material">
		<div class="layout">
			<div class="layout__wrapper layout__wrapper_type_narrow layout__wrapper_fixed">
				<main class="layout__main">
					<div class="lesson-material__wrapper">
						<a class="nav-tab nav-tab_back nav-tab_view_button" href="../..">
						<span data-lego="react"
						      class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span>
							<span class="nav-tab__inner">Урок Облако</span>
						</a>
						<section class="lesson-material__content">
							<article class="material"><h1>Разворачиваем проект в&nbsp;облаке. Дорешка</h1>
<section class="material__plan"><nav>
<ol>
<li><a class="material__link" href="#1">Введение</a></li>
<li><a class="material__link" href="#2">Туннель в&nbsp;Интернет</a></li>
<li><a class="material__link" href="#3">Glitch.com</a></li>
<li><a class="material__link" href="#4">Яндекс.Облако</a></li>
</ol>
</nav></section>
<section class="material__annotation">
<h2>Аннотация</h2>
<p>Сегодня мы&nbsp;посмотрим, как разместить свой проект в&nbsp;Интернете, чтобы к&nbsp;нему могли получить доступ все желающие, а&nbsp;также изучим несколько сервисов, которые смогут нам в&nbsp;этом помочь.</p>
<p>Этот урок не содержит задач.</p>
</section>
<section class="material__chapter">
<h2 id="1">Введение</h2>
<p>Разрабатывать веб-приложения, которые &laquo;живут&raquo; только на&nbsp;нашем локальном компьютере, согласитесь, не&nbsp;очень весело. Само слово &laquo;веб&raquo; подразумевает, что к&nbsp;результатам нашей работы должны иметь доступ все пользователи сети Интернет, ну&nbsp;или&nbsp;те, которым мы&nbsp;даем на&nbsp;это право. Процесс размещения ресурсов в&nbsp;Интернете называется deploy.</p>
<p>Пока наше flask-приложение размещено на&nbsp;локальном компьютере, и&nbsp;мы&nbsp;помним, что каждый компьютер в&nbsp;мире думает про себя, что его IP-адрес 127.0.0.1. Как&nbsp;же тогда пользовательский запрос из&nbsp;Интернета может добраться до&nbsp;нашего компьютера и&nbsp;получить нужную веб-страницу или json-ответ от&nbsp;сервиса? Ведь таких машин с&nbsp;адресом 127.0.0.1&nbsp;миллионы!</p>
<p>Для решения этой задачи есть несколько способов и&nbsp;множество разных сервисов. С&nbsp;некоторыми из&nbsp;них мы&nbsp;сегодня познакомимся.</p>
<p>Давайте сделаем простейшее веб-приложение, на&nbsp;примере которого мы&nbsp;будем проверять различные способы организации доступа к&nbsp;веб-приложению через Интернет.</p>
<pre><code class="language-python">import os

from flask import Flask

app = Flask(__name__)


@app.route("/")
def index():
    return "Привет от приложения Flask"


if __name__ == '__main__':
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port)
</code></pre>
<p>Из&nbsp;нового: <var>os.environ</var> пытается получить значение переменной окружения с&nbsp;именем <var>PORT</var>, а&nbsp;если не&nbsp;получается, то&nbsp;выставляет порт 5000. Это нам пригодится позднее.</p>
<p><code>host = 0.0.0.0</code>&nbsp;означает, что мы&nbsp;разрешаем подключения из&nbsp;любой сети по&nbsp;любому интерфейсу.</p>
</section>
<section class="material__chapter">
<h2 id="2">Туннель в&nbsp;Интернет</h2>
<p>Очень часто при отладке веб-приложений хочется посмотреть, что происходит, когда в&nbsp;приложение приходят запросы из&nbsp;Интернета, или продемонстрировать результаты работы другу/заказчику. Не&nbsp;всегда удобно ради тестирования или ради одноразовой демонстрации арендовать и&nbsp;настраивать сервер в&nbsp;Интернете.</p>
<p>Согласитесь, было&nbsp;бы удобно получить какой-то временный адрес в&nbsp;Интернете &laquo;в&nbsp;один клик&raquo; для таких целей. К&nbsp;счастью, для этого есть сервисы, которые организуют виртуальный туннель из&nbsp;Интернета на&nbsp;ваш локальный компьютер. Один из&nbsp;них&nbsp;&mdash; <a class="material__link" href="https://ngrok.com/" target="_blank" rel="noopener noreferrer">ngrok</a>.</p>
<p>Важная его особенность: у&nbsp;ngrok есть бесплатный план, но&nbsp;даже этой ограниченной версии хватит для наших целей. Сначала надо зарегистрироваться и залогиниться на <a class="material__link" href="https://ngrok.com" target="_blank" rel="noopener noreferrer">сайте</a> сервиса.</p>
<p>На странице <a class="material__link" href="https://dashboard.ngrok.com/get-started/setup" target="_blank" rel="noopener noreferrer">"Setup &amp; Installation"</a> приведена подробная инструкция по настройке и запуску утилиты.</p>
<p>1. Необходимо скачать исполняемый файл приложения для нужной операционной системы со&nbsp;<a class="material__link" href="https://ngrok.com/download" target="_blank" rel="noopener noreferrer">страницы загрузки</a>.</p>
<p>2. Распаковать архив и в окне терминала перейти в папку с распакованной утилитой.</p>
<p>3. Скопировать со страницы "Setup &amp; Installation" команду для настройки работы ngrok с вашей учетной записью и запустить ее в терминале. Выглядит она так <code>ngrok authtoken 25srTxReQIIwsPMX67ZiY1E5TMH_7KbpfVGLcg9rRDd2hwfk9</code></p>
<p>4. Настройка завершена.</p>
<p>Теперь запустим наше тестовое приложение в&nbsp;PyCharm или через командную строку. Выполним в&nbsp;терминале команду:</p>
<pre><code>ngrok http 5000
</code></pre>
<p>После этого ngrok создаст временный адрес в&nbsp;Интернете вида <code>набор_символов.ngrok.io</code> и&nbsp;виртуальный туннель с&nbsp;этого адреса на&nbsp;пятитысячный порт нашего локального компьютера. Теперь все запросы по&nbsp;протоколу http и&nbsp;https, которые придут на&nbsp;созданный временный адрес, будут перенаправляться на&nbsp;наш компьютер. Давайте проверим. Перейдем по&nbsp;этому адресу (скопируем и&nbsp;вставим его в&nbsp;строку запроса браузера) и&nbsp;посмотрим на&nbsp;результат.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/second-year/web/web-cloud-2.png" width="361" height="auto" /></div>
<p>Все работает! А&nbsp;в&nbsp;консоли ngrok появилось сообщение, что GET-запрос успешно обработан:</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" src="https://yastatic.net/s3/lyceum/content/images/second-year/web/web-cloud-3.png" width="501" height="auto" /></div>
<p>Таким образом можно организовывать тестирование приложения в&nbsp;Интернете. Особенно такой подход удобен, когда для проверки функциональности приложения надо получить запрос извне. В&nbsp;дальнейшем мы&nbsp;будем использовать эту методику при отладке приложений для голосового помощника Алисы.</p>
</section>
<section class="material__chapter">
<h2 id="3">Glitch.com</h2>
<p>Более продвинутый способ, который (при использовании платных планов) подойдет для &laquo;боевого&raquo; разворачивания приложения в&nbsp;Интернете (деплоя)&nbsp;&mdash; аренда контейнеров для приложений на&nbsp;одном из&nbsp;множества сервисов, которые предоставляют такие услуги.</p>
<p>Сервисов действительно очень много, и&nbsp;все они разнятся как в&nbsp;стоимости (некоторые предлагают бесплатный тариф, который подойдет для приложения с&nbsp;небольшим количеством пользователей), так и&nbsp;в&nbsp;сложности настроек для запуска.</p>
<p>В&nbsp;качестве одного из&nbsp;самых легких стоит привести в&nbsp;пример <a class="material__link" href="https://www.pythonanywhere.com/" target="_blank" rel="noopener noreferrer">pythonanywhere.com</a>, который содержит ряд преднастроенных шаблонов для различных приложений, разработанных на&nbsp;Python. К&nbsp;недостатку этого сервиса можно отнести&nbsp;то, что приложения, размещенные на&nbsp;нем, могут обращаться только к&nbsp;тем ресурсам, которые были внесены в&nbsp;&laquo;белый список&raquo; доступных адресов.</p>
<p>Немного более сложным в обращении является сервис <a class="material__link" href="https://glitch.com" target="_blank" rel="noopener noreferrer">Glitch</a>. Он&nbsp;поддерживает приложения не&nbsp;только на&nbsp;Python, но&nbsp;и&nbsp;на&nbsp;других языках программирования.</p>
<p>Зарегистрируйтесь на&nbsp;Glitch. После чего можно приступать к созданию нового приложения. Сначала надо его подготовить к размещению на сервисе.</p>
<ol>
<li>Переименуйте основной запускаемый файл вашего проекта и назовите его <code>"server.py"</code></li>
<li>В корне проекта создайте файл <code>".gitignore"</code>со следующим содержимым:
<pre><code class="language-python">.idea
venv</code></pre>
Это необходимо, чтобы файл из этих служебных папок игнорировались системой контроля версий.</li>
<li>Создайте файл <code>"requirements.txt"</code> со списком библиотек, которые необходимы для вашего приложения.</li>
<li>В корне проекта создайте файл <code>"start.sh"</code>со следующим содержимым:
<pre><code class="language-python">#!/bin/bash

# Exit early on errors
set -eu

# Python buffers stdout. Without this, you won't see what you "print" in the Activity Logs
export PYTHONUNBUFFERED=true

# Install Python 3 virtual env
VIRTUALENV=./venv

if [ ! -d $VIRTUALENV ]; then
  python3 -m venv $VIRTUALENV
fi

# Install pip into virtual environment
if [ ! -f $VIRTUALENV/bin/pip ]; then
  curl --silent --show-error --retry 5 https://bootstrap.pypa.io/get-pip.py | $VIRTUALENV/bin/python
fi

# Install the requirements
$VIRTUALENV/bin/pip install -r requirements.txt

# Run your glorious application
$VIRTUALENV/bin/python3 server.py</code></pre>
Этот файл содержит скрипт, который создает виртуальное окружение python для запуска вашего приложения, устанавливает необходимые библиотеки, и запускает его.</li>
<li>Создайте git репозиторий и разместите его на github. Репозиторий надо сделать публичным.</li>
</ol>
<p>Теперь ваше приложение готово к публикации на сервисе <strong>Glitch</strong>.</p>
<p>На верхней панели справа нажмите на кнопку <code>"New project"</code>, затем надо выбрать <code>"Import from
        Github"</code>, в появившееся диалоговое окно вставьте полный путь до вашего репозитирия с приложением.</p>
<div class="material__content-positioner"><img src="https://yastatic.net/s3/lyceum/lyceum/01_cloud.png" alt="" /></div>
<p>После этого все файлы вашего приложения будут загружены на сервер Glitch, будет запущен скрипт <code>start.sh</code>, и примерно через 3-5 минут ваше приложение будет работать. Об этом будет свидетельствовать смайлик на панели внизу экрана рядом с надписью <strong>Status</strong>.</p>
<div class="material__content-positioner"><img src="https://yastatic.net/s3/lyceum/lyceum/02_cloud.png" alt="" /></div>
<p>В этой же панели нажмите на кнопку <strong>Preview</strong> далее <strong>Preview in new window</strong>, и у ваше приложение откроется в новом окне.</p>
<p>Все. Можно переходить по&nbsp;адресу <code>имя_приложения.glitch.me</code> и&nbsp;наслаждаться результатом. В настройках приложения вы можете поменять его имя.</p>
<p>Если вам понадобится изменить код приложения, то необходимо будет удалить (поместить в архив) старое приложение и сделать новое, загрузив с github новый код.</p>
</section>
<section class="material__chapter">
<h2 id="4">Яндекс.Облако</h2>
<p>Самым сложным, но&nbsp;одновременно самым гибким и&nbsp;продвинутым вариантом является размещение приложения на&nbsp;облачной виртуальной машине с&nbsp;использованием сервиса Яндекс.Облако или аналогов.</p>
<p>Создание и&nbsp;настройка таких виртуальных машин требует определенных усилий и&nbsp;несколько сложнее, чем сервисы, которые мы&nbsp;рассматривали ранее, но&nbsp;зато вы&nbsp;сможете полностью контролировать результат и&nbsp;реализовывать разные продвинутые сценарии разворачивания вашего приложения.</p>
<p>Для начала необходимо зайти на&nbsp;<a class="material__link" href="http://cloud.yandex.ru/" target="_blank" rel="noopener noreferrer">Яндекс.Облако</a> и&nbsp;нажать кнопку &laquo;Подключиться&raquo; в&nbsp;правом верхнем углу экрана. Далее алгоритм работы можно описать так:</p>
<ol>
<li>Необходимо создать виртуальную машину</li>
<li>Выбрать и&nbsp;установить образ операционной системы, которую вы&nbsp;планируете использовать. Можно использовать как &laquo;чистый&raquo; образ (только операционная система), так и&nbsp;подготовленный командой Яндекс.Облака или сторонними разработчиками</li>
<li>Установить все необходимое&nbsp;ПО: интерпретатор Python, все библиотеки, системные утилиты, которые обеспечат работу при большой нагрузке и&nbsp;т.&nbsp;д.</li>
<li>Загрузить разработанный вами сервер и&nbsp;...</li>
<li>Поддерживать работу вашего ресурса</li>
</ol>
</section></article>
						</section>
					</div>
				</main>
			</div>
		</div>
<footer class="footer">
	<div class="footer__controls">
		<a rel="noopener noreferrer" target="_blank" class="footer__help-link"
		   href="https://yandex.ru/legal/lms_termsofuse/">Terms of use</a>
	</div>
	<div class="footer__copyright">
		<div>
			<div class="Markdown">
				<div class="paragraph">Generated by <a rel="noopener noreferrer" target="_blank"
				                                       class="footer__help-link"
				                                       href="https://github.com/rodion-gudz/YandexLyceumDocs">Yandex Lyceum Docs</a>
				</div>
			</div>
		</div>
	</div>
</footer>	</div>
	<script src="/js/prism.js"></script>
</body>
</html>