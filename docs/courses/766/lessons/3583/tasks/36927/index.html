<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Задача "Магазины по пути" </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/vendors.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="layout">
		<div class="layout__wrapper layout__wrapper_type_narrow">
			<main class="layout__main"><a
					class="nav-tab nav-tab_back nav-tab_view_button"
					href="../.."><span data-lego="react"
			                           class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span><span
					class="nav-tab__inner">Урок Асинх. прогр.</span></a>
				<nav class="yd407c--arrow-navigation">
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_left"
						   href="../36926">
                    <span data-lego="react"
                          class="icon icon_type_scroll icon_direction_left icon_size_l"></span></a>
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_right"
						   href="../36928">
                        <span data-lego="react"
                              class="icon icon_type_scroll icon_direction_right icon_size_l"></span></a>
				</nav>
				<header class="yde1c4--task-header">
					<h1 class="heading heading_level_1 yde1c4--task-header__heading">Магазины по пути</h1>
					<div class="y43a24--task-info__tag">
						<span class="task-tag task-tag_type_additional task-tag_size_m"></span>
						<div class="y43a24--task-info__tag-name">Дополнительные задачи</div>
					</div>
				</header>
				<section class="y6c2ac--task-description">
					<article class="y6c2ac--task-description__content">
						<!DOCTYPE html
  SYSTEM "html">
<div class="problem-statement">
   <div class="header">
      <h1 class="title">Магазины по пути</h1>
      <table>
         <tr class="time-limit">
            <td class="property-title">Ограничение времени</td>
            <td>1&nbsp;секунда</td>
         </tr>
         <tr class="memory-limit">
            <td class="property-title">Ограничение памяти</td>
            <td>64Mb</td>
         </tr>
         <tr class="input-file">
            <td class="property-title">Ввод</td>
            <td colspan="1">стандартный ввод или input.txt</td>
         </tr>
         <tr class="output-file">
            <td class="property-title">Вывод</td>
            <td colspan="1">стандартный вывод или output.txt</td>
         </tr>
      </table>
   </div>
   <h2></h2>
   <div class="legend"><span style="">
         <p>Едем в гости с пересадками, по пути нужно зайти в магазины и купить подарки. Магазины есть на всех остановках, затраты времени
            на выбор и покупку одинаковых подарков везде одинаковы. У каждого подарка есть время, необходимое для его выбора, в течение
            которого покупатель не может отвлекаться на другие действия, и есть время, когда подарок упаковывают – в это время можно заняться
            другими делами. 
         </p>
         <p>Напишите асинхронную программу, выводящую последовательность действий. На каждой остановке нужно стремиться покупать подарки
            в порядке уменьшения общего времени покупки каждого из них.
         </p>
         <p>Время будем измерять целыми числами вдоль линейной шкалы. Чтобы программа выполнялась быстрее, все временные задержки разделите
            на 100. 
         </p></span></div>
   <h2>Формат ввода</h2>
   <div class="input-specification"><span style="">
         <p>Сначала для каждой остановки по пути вводятся пары чисел:<br> количество времени до отправления, длительность поездки. 
         </p>
         <p>Затем пустая строка и снова до пустой строки вводятся:<br>название подарка, время на выбор и время на его покупку и упаковку. 
         </p>
         <p>Купить подарок можно на любой остановке, все, что купить в пути не успели, нужно купить по прибытии. </p></span></div>
   <h2>Формат вывода</h2>
   <div class="output-specification"><span style="">
         <p>Выводить полученные результаты нужно так:<br></p>
         <p>на каждой остановке (первая та, которая перед посадкой) вывести:<br><span style="font-style:italic;">Buying gifts at &lt;номер&gt; stop</span><br></p>
         <p>Затем при начале покупки подарка вывести строку:<br><span style="font-style:italic;">Buy &lt;название подарка&gt;</span><br></p>
         <p>При окончании строку:<br><span style="font-style:italic;">Got &lt;название подарка&gt;</span><br></p>
         <p>Перед отправлением от остановки вывести строку:<br><span style="font-style:italic;">Arrive from &lt;номер&gt; stop</span><br></p>
         <p>Если остались не купленные в пути подарки, то по прибытии вывести:<br><span style="font-style:italic;">Buying gifts after arrival</span><br></p>
         <p>а затем оставшиеся подарки опять асинхронно.<br></p>
         <p>Если на какой-то остановке не можем купить подарки (они закончились или недостаточно времени на покупку), выводить строки
            о начале покупок и об отправлении от остановки, но без указания покупок. 
         </p></span></div>
   <h3>Пример 1</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>7 6
9 8
6 7

a 2 2
b 3 1
c 3 2
d 4 2
e 1 0

</pre></td>
            <td><pre>Buying gifts at 1 stop
Buy d
Buy e
Got e
Got d
Arrive from 1 stop
Buying gifts at 2 stop
Buy c
Buy a
Got c
Got a
Arrive from 2 stop
Buying gifts at 3 stop
Buy b
Got b
Arrive from 3 stop
</pre></td>
         </tr>
      </tbody>
   </table>
   <h3>Пример 2</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>7 6
11 2
7 4

I 4 2
J 3 0
L 0 1

</pre></td>
            <td><pre>Buying gifts at 1 stop
Buy I
Buy L
Got L
Got I
Arrive from 1 stop
Buying gifts at 2 stop
Buy J
Got J
Arrive from 2 stop
Buying gifts at 3 stop
Arrive from 3 stop
</pre></td>
         </tr>
      </tbody>
   </table>
   <h3>Пример 3</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>6 2
3 2
3 10

K 5 1
M 3 0
A 4 3
C 4 0
R 5 2
T 2 1

</pre></td>
            <td><pre>Buying gifts at 1 stop
Buy K
Got K
Arrive from 1 stop
Buying gifts at 2 stop
Buy M
Got M
Arrive from 2 stop
Buying gifts at 3 stop
Buy T
Got T
Arrive from 3 stop
Buying gifts after arrival
Buy A
Buy C
Buy R
Got C
Got A
Got R
</pre></td>
         </tr>
      </tbody>
   </table>
   <h2>Примечания</h2>
   <div class="notes"><span style="">
         <p>Хотя бы один подарок нужно купить в пути.</p></span></div>
</div>
								<h2>Решение</h2>
								<a class="nav-tab nav-tab_back nav-tab_view_button"
								   href="https://yastatic.net/s3/lyceum/files/3367009a-cb14-4304-bc9a-68aca466d6a7/solution.py"><span data-lego="react"
								                                   class="icon icon_type_arrow-short icon_direction_down icon_size_s nav-tab__arrow-icon"></span><span
										class="nav-tab__inner">Скачать</span></a>
									<details>
										<summary>Код</summary>
										<pre class="language-python" style="border-radius: 15px"><code
												class="language-python">import asyncio
import os
from time import sleep


async def buy(gift):
    await asyncio.sleep(gift[1] * 0.01)
    print(f'Buy {gift[0]}')
    
    await asyncio.sleep(gift[2] * 0.01)
    print(f'Got {gift[0]}')


async def station(station):
    print(f'Buying gifts at {station[0]} stop')
    await asyncio.sleep(0.01 * station[1])
    
    print(f'Arrive from {station[0]} stop')
    sleep(station[2] * 0.01)


async def main(data, gifts):
    for i in data:
        tasks = []
        
        number = i[0]
        arr_time = i[1]
        
        max_time = 0
        
        count = 0
        
        while True:
            if count >= len(gifts):
                break
            
            if gifts[count][1] + max(max_time, gifts[count][2]) <= arr_time:
                arr_time -= gifts[count][1]
                max_time = max(max_time, gifts[count][2])
                
                tasks.append(asyncio.create_task(buy(gifts[count])))
                
                gifts.pop(count)               
                count = 0
                
            else:
                count += 1
        
        await asyncio.gather(station(i))
        await asyncio.gather(*tasks)
    
    if len(gifts) > 0:
        tasks = []
        print('Buying gifts after arrival')
        
        for task in gifts:
            tasks.append(buy(task))
            
        await asyncio.gather(*tasks)
          

if os.name == 'nt':
    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())


a = input()
count = 1
spis = []

while a != '':
    spis.append((count, int(a.split()[0]), int(a.split()[1])))
    count += 1
    a = input()
 
a = input()   
gifts = []

while a != '':
    gifts.append((a.split()[0], int(a.split()[1]), int(a.split()[2])))
    a = input()

asyncio.run(main(spis, sorted(gifts, key=lambda a: (a[1], a[2]), reverse=True)))</code></pre>
									</details>
							</article>
				</section>
			</main>
		</div>
		<aside class="layout__active-area">
			<nav class="yd609d--task-group-navigation">
				<ul class="yd609d--task-group-navigation__groups">
						<li class="yd609d--task-group-navigation__group"><span
								class="task-tag task-tag_type_additional task-tag_size_l yd609d--task-group-navigation__tag"
								tabindex="8"></span>
							<ul class="yd609d--task-group-navigation__tasks">
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36925">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36926">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link  yd609d--task-group-navigation__link_checked"
											   href="../36927">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36928">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36929">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
							</ul>
						</li>
				</ul>
			</nav>
		</aside>
	</div>
	<script src="/js/prism.js"></script>
</body>
</html>