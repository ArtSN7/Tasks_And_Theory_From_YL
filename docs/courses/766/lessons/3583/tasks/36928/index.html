<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Задача "Ищем астероиды" </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/vendors.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="layout">
		<div class="layout__wrapper layout__wrapper_type_narrow">
			<main class="layout__main"><a
					class="nav-tab nav-tab_back nav-tab_view_button"
					href="../.."><span data-lego="react"
			                           class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span><span
					class="nav-tab__inner">Урок Асинх. прогр.</span></a>
				<nav class="yd407c--arrow-navigation">
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_left"
						   href="../36927">
                    <span data-lego="react"
                          class="icon icon_type_scroll icon_direction_left icon_size_l"></span></a>
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_right"
						   href="../36929">
                        <span data-lego="react"
                              class="icon icon_type_scroll icon_direction_right icon_size_l"></span></a>
				</nav>
				<header class="yde1c4--task-header">
					<h1 class="heading heading_level_1 yde1c4--task-header__heading">Ищем астероиды</h1>
					<div class="y43a24--task-info__tag">
						<span class="task-tag task-tag_type_additional task-tag_size_m"></span>
						<div class="y43a24--task-info__tag-name">Дополнительные задачи</div>
					</div>
				</header>
				<section class="y6c2ac--task-description">
					<article class="y6c2ac--task-description__content">
						<div class="problem-statement problem-statement_type_markdown">
<div class="header">
<h1 class="title">Ищем астероиды</h1>
<table class="sample-tests">
<tbody>
<tr class="time-limit">
<td class="property-title">Ограничение времени</td>
<td>20&nbsp;секунд</td>
</tr>
<tr class="memory-limit">
<td class="property-title">Ограничение памяти</td>
<td>92.6 Мб</td>
</tr>
<tr class="input-file">
<td class="property-title">Ввод</td>
<td colspan="1">стандартный ввод или input.txt</td>
</tr>
<tr class="output-file">
<td class="property-title">Вывод</td>
<td colspan="1">стандартный вывод или output.txt</td>
</tr>
</tbody>
</table>
</div>
<h2></h2>
<div class="legend">
<div class="Markdown">
<p class="paragraph">Есть такие астрономические проекты (например, <em>zooniverse.org</em>), в которых любой пользователь компьютера может помочь ученым обнаружить заданные объекты на фотографиях. В рассматриваемом проекте нужно искать треки астероидов, которые могут угрожать Земле. В перспективе можно будет обучить нейронную сеть распознавать такие объекты на снимках телескопов, но для их обучения также нужны фотографии, размеченные людьми. Пока без их помощи не обойтись.</p>
<p class="paragraph">Вам нужно подготовить фотографии, на которых, возможно, есть такие треки. Для этого нужно для каждого изображения определить процент (<strong>percent</strong>) пикселей цвета, который отвечает двум критериям: он ярче среднего значения; он встречается чаще всего в изображении среди пикселей, отвечающих первому критерию. Так как ожидаемый процент невелик, умножьте его на 100_000 и округлите до целых вниз.</p>
<p class="paragraph">Также нужно определить относительное количество (<strong>amount</strong>) различных пикселей, яркость которых выше средней. (Количество таких пикселей умножить на 100, разделить на общее число пикселей и округлить до целого вниз.)</p>
<p class="paragraph">И, наконец, для каждого файла нужно определить четверть (как на декартовой плоскости) (<strong>quarter</strong>), где больше всего пикселей с яркостью выше средней, &ndash; I, II, III или IV. Если в нескольких значения одинаковы, то брать меньшую по номеру.</p>
<p class="paragraph">Яркостью пикселя считается сумма интенсивностей всех трех компонент цвета.</p>
<p class="paragraph">Для имитации увеличения времени при работе с большими файлами, сделайте временную задержку 0.1 с при определении средней яркости фотографии.</p>
<p class="paragraph">Напишите асинхронную функцию <strong>asteroids()</strong>, которая принимает произвольное число имен файлов, а возвращает список кортежей <em>(имя файла, процент, количество, четверть)</em>.<br />При начале обработки фотографии функция должна печатать строку <em>Start &lt;имя файла&gt;</em>, при получении каждого результата<br /><em>Done &lt;имя файла&gt;, percent &lt;значение&gt;</em><br /><em>Done &lt;имя файла&gt;, amount &lt;значение&gt;</em><br /><em>Done &lt;имя файла&gt;, quarter &lt;значение&gt;</em><br />По окончании работы с файлом вывести строку: <em>Ready &lt;имя файла&gt;</em></p>
<p class="paragraph">Пример фотографии для обработки:<br /><img alt="result" src="https://contest.yandex.ru/testsys/markdown-image?code=eyJwYXRoIjoiNy5qcGciLCJwcm9ibGVtSWQiOiI1NDAwNjMvMjAyMl8wNl8wNy9rM1V6WE82ZmZZIiwic2lnbiI6Ijk0YmQxZDNkYzlmYmFiYjFmNzgxNmI5Mjc1OGYwZTcwODRhNmFiYjMzMmM1MTRlM2E4OTBmOGQyYjcxNDczZTYifQ==" style="width: 60%;" /></p>
</div>
</div>
<h2>Пример</h2>
<div>
<table class="sample-tests">
<thead>
<tr>
<th>Ввод</th>
<th>Вывод</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<pre>data = ['1.jpg', '2.jpg', '3.jpg', '4.jpg']
print(asyncio.run(asteroids(*data)))
</pre>
</td>
<td>
<pre>Start 1.jpg
Start 2.jpg
Start 3.jpg
Start 4.jpg
Done 1.jpg, percent 22
Done 1.jpg, amount 36
Done 1.jpg, quarter I
Done 2.jpg, percent 41
Done 3.jpg, percent 2117
Done 2.jpg, quarter II
Done 2.jpg, amount 43
Done 3.jpg, amount 18
Done 4.jpg, percent 90
Done 3.jpg, quarter III
Done 4.jpg, amount 27
Done 4.jpg, quarter I
Ready 1.jpg
Ready 2.jpg
Ready 3.jpg
Ready 4.jpg
[('1.jpg', 22, 36, 'I'), ('2.jpg', 41, 43, 'II'), ('3.jpg', 2117, 18, 'III'), ('4.jpg', 90, 27, 'I')]
</pre>
</td>
</tr>
</tbody>
</table>
</div>
<h2>Примечания</h2>
<div class="notes">
<div class="Markdown">
<p class="paragraph">Расположение четвертей на изображении:<br /><img alt="result" src="https://contest.yandex.ru/testsys/markdown-image?code=eyJwYXRoIjoicXVhcnRlcnMucG5nIiwicHJvYmxlbUlkIjoiNTQwMDYzLzIwMjJfMDZfMDcvazNVelhPNmZmWSIsInNpZ24iOiI2YWMyMjQzMDEwNzc4YzZhYmI5OGQ3MTUyZDk0NDc2ZWVjNzZlYjVmZGU0Yjg2YTA1OGI2YjI3YWZkOTc5MjcxIn0=" style="width: 60%;" /></p>
</div>
</div>
</div>
								<h2>Решение</h2>
								<a class="nav-tab nav-tab_back nav-tab_view_button"
								   href="https://yastatic.net/s3/lyceum/files/abb959f6-7b7a-4112-8fce-fd63ea34cd01/solution.py"><span data-lego="react"
								                                   class="icon icon_type_arrow-short icon_direction_down icon_size_s nav-tab__arrow-icon"></span><span
										class="nav-tab__inner">Скачать</span></a>
									<details>
										<summary>Код</summary>
										<pre class="language-python" style="border-radius: 15px"><code
												class="language-python">import asyncio
from PIL import Image
from math import floor


async def asteroids(*array):
    tasks = [work(i) for i in array] 
    return await asyncio.gather(*tasks)


async def start(a):
    print(f'Start {a}')
    
    
async def ready(a):
    print(f'Ready {a}')
    
    
async def work(filename):
    await start(filename)
    
    im = Image.open(filename)
    x, y = im.size

    pixels = im.load()
    brightnesses = {}
    brightnesses0 = {}

    for i in range(x):
        for j in range(y):
            r, g, b = pixels[i, j]
            clr = r + g + b
            if clr not in brightnesses:
                brightnesses[clr] = 1
            else:
                brightnesses[clr] += 1
            if (r, g, b) not in brightnesses0:
                brightnesses0[(r, g, b)] = 1
            else:
                brightnesses0[(r, g, b)] += 1             
    await asyncio.sleep(0.1)
    
    mean = sum([i[0] * i[1] for i in brightnesses.items()]) / sum(brightnesses.values())
    most = list(map(lambda x: x[1], filter(lambda x: x[0] > mean, brightnesses.items())))
    total_len = sum(brightnesses.values())
    max_pxl = max(filter(lambda x: sum(x[0]) > mean, brightnesses0.items()), key=lambda x: x[1])
    
    im = None
    brightnesses0 = None
    
    print(f'Done {filename}, percent {floor(max_pxl[1] / total_len * 100000)}')
    await asyncio.sleep(0.1)
    
    print(f'Done {filename}, amount {floor(100 * sum(most) / total_len)}')
    await asyncio.sleep(0.1)
    
    most = None
    quartes = {'I': 0, 'II': 0, 'III': 0, 'IV': 0}
    
    for i in range(x // 2, x):
        for j in range(y // 2):
            r, g, b = pixels[i, j]
            if r + g + b > mean:
                quartes['I'] += 1
    await asyncio.sleep(0.1)
    
    for i in range(x // 2):
        for j in range(y // 2):
            r, g, b = pixels[i, j]
            if r + g + b > mean:
                quartes['II'] += 1
    await asyncio.sleep(0.1)
    
    for i in range(x // 2):
        for j in range(y // 2, y):
            r, g, b = pixels[i, j]
            if r + g + b > mean:
                quartes['III'] += 1
    await asyncio.sleep(0.1)
    
    for i in range(x // 2, x):
        for j in range(y // 2, y):
            r, g, b = pixels[i, j]
            if r + g + b > mean:
                quartes['IV'] += 1
    await asyncio.sleep(0.1)
    
    n1 = quartes['I']
    n2 = quartes['II']
    n3 = quartes['III']
    n4 = quartes['IV']
    quartes = None
    
    most = {n1: ['I']}
    if n2 not in most:
        most[n2] = ['II']
    if n3 not in most:
        most[n3] = ['III']
    if n4 not in most:
        most[n4] = ['IV']
        
    print(f'Done {filename}, quarter {min(max(most.items(), key=lambda x: x[0])[1])}')
    await asyncio.sleep(0.1)
    
    await ready(filename)
    
    a = floor(max_pxl[1] / total_len * 100000)
    a1 = floor(100 * sum(most) / total_len)
    a2 = min(max(most.items(), key=lambda x: x[0])[1])
    return filename, a, a1, a2</code></pre>
									</details>
							</article>
				</section>
			</main>
		</div>
		<aside class="layout__active-area">
			<nav class="yd609d--task-group-navigation">
				<ul class="yd609d--task-group-navigation__groups">
						<li class="yd609d--task-group-navigation__group"><span
								class="task-tag task-tag_type_additional task-tag_size_l yd609d--task-group-navigation__tag"
								tabindex="8"></span>
							<ul class="yd609d--task-group-navigation__tasks">
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36925">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36926">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36927">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link  yd609d--task-group-navigation__link_checked"
											   href="../36928">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../36929">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
							</ul>
						</li>
				</ul>
			</nav>
		</aside>
	</div>
	<script src="/js/prism.js"></script>
</body>
</html>