<!-- Generated by https://github.com/rodion-gudz/YandexLyceumDocs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Задача "Фильмотека 1.0" </title>
    <link rel="stylesheet" href="/css/client.css"/>
	<link rel="stylesheet" href="/css/vendors.css">
	<link rel="stylesheet" href="/css/prism.css"/>
</head>
<body>
	<div class="layout">
		<div class="layout__wrapper layout__wrapper_type_narrow">
			<main class="layout__main"><a
					class="nav-tab nav-tab_back nav-tab_view_button"
					href="../.."><span data-lego="react"
			                           class="icon icon_type_arrow-short icon_direction_left icon_size_s nav-tab__arrow-icon"></span><span
					class="nav-tab__inner">Урок QT SQL 2</span></a>
				<nav class="yd407c--arrow-navigation">
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_left"
						   href="../26003">
                    <span data-lego="react"
                          class="icon icon_type_scroll icon_direction_left icon_size_l"></span></a>
						<a class="yd407c--arrow-navigation__arrow yd407c--arrow-navigation__arrow_direction_right"
						   href="../25929">
                        <span data-lego="react"
                              class="icon icon_type_scroll icon_direction_right icon_size_l"></span></a>
				</nav>
				<header class="yde1c4--task-header">
					<h1 class="heading heading_level_1 yde1c4--task-header__heading">Фильмотека 1.0</h1>
					<div class="y43a24--task-info__tag">
						<span class="task-tag task-tag_type_homework task-tag_size_m"></span>
						<div class="y43a24--task-info__tag-name">Домашняя работа</div>
					</div>
				</header>
				<section class="y6c2ac--task-description">
					<article class="y6c2ac--task-description__content">
						<p>Напишите программу с&nbsp;графическим пользовательским интерфейсом на&nbsp;PyQt, которая позволяет просматривать и&nbsp;добавлять данные в&nbsp;таблицу Films базы данных films_db.sqlite.</p>
<p>Информацию о&nbsp;фильмах отобразите в&nbsp;табличном виде, а&nbsp;для жанра выведите его текстовое название (подумайте, как это можно сделать с&nbsp;помощью SQL запроса, <a href="https://ru.wikipedia.org/wiki/Join_(SQL)" target="_blank" rel="noopener">вот это</a> может помочь). Добавление данных должно быть реализовано путем заполнения данных в&nbsp;отдельные виджеты для каждого поля таблицы films, наиболее подходящие для этого. Виджеты для добавления записи должны располагаться на&nbsp;отдельной форме приложения. После добавления записи необходимо обновить таблицу с&nbsp;отображением данных.</p>
<p>Предусмотрите сообщения для ошибочного пользовательского ввода, например, отрицательной длины, года в&nbsp;будущем и&nbsp;т.&nbsp;д.</p>
<p><img src="https://yastatic.net/s3/lyceum/content/problems/qt8/filmoteka.gif" alt="" width="550" height="443" /></p>
<h2>Примечания</h2>
<div class="notes">Задание проверяется преподавателем.</div>
								<h2>Решение</h2>
								<a class="nav-tab nav-tab_back nav-tab_view_button"
								   href="https://yastatic.net/s3/lyceum/files/4bebe0a4-f6cb-44d2-9214-f14d9ea3cdf3/solution.py"><span data-lego="react"
								                                   class="icon icon_type_arrow-short icon_direction_down icon_size_s nav-tab__arrow-icon"></span><span
										class="nav-tab__inner">Скачать</span></a>
									<details>
										<summary>Код</summary>
										<pre class="language-python" style="border-radius: 15px"><code
												class="language-python">import sys
import sqlite3
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import QApplication, QMainWindow, QTableWidgetItem

asa = None


class Ui_HomeWindow(object):
    def setupUi(self, HomeWindow):
        HomeWindow.setObjectName("HomeWindow")
        HomeWindow.resize(800, 600)
        self.centralwidget = QtWidgets.QWidget(HomeWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.pushButton = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton.setGeometry(QtCore.QRect(10, 10, 341, 23))
        self.pushButton.setObjectName("pushButton")
        self.tableWidget = QtWidgets.QTableWidget(self.centralwidget)
        self.tableWidget.setGeometry(QtCore.QRect(0, 50, 791, 501))
        self.tableWidget.setObjectName("tableWidget")
        self.tableWidget.setColumnCount(0)
        self.tableWidget.setRowCount(0)
        HomeWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(HomeWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 800, 21))
        self.menubar.setObjectName("menubar")
        HomeWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(HomeWindow)
        self.statusbar.setObjectName("statusbar")
        HomeWindow.setStatusBar(self.statusbar)

        self.retranslateUi(HomeWindow)
        QtCore.QMetaObject.connectSlotsByName(HomeWindow)

    def retranslateUi(self, HomeWindow):
        _translate = QtCore.QCoreApplication.translate
        HomeWindow.setWindowTitle(_translate("HomeWindow", "MainWindow"))
        self.pushButton.setText(_translate("HomeWindow", "ДОБАВИТЬ"))


class Ui_OKNOWindow(object):
    def setupUi(self, OKNOWindow):
        OKNOWindow.setObjectName("OKNOWindow")
        OKNOWindow.resize(426, 396)
        self.centralwidget = QtWidgets.QWidget(OKNOWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(10, 10, 61, 16))
        self.label.setObjectName("label")
        self.lineEdit = QtWidgets.QLineEdit(self.centralwidget)
        self.lineEdit.setGeometry(QtCore.QRect(90, 10, 291, 20))
        self.lineEdit.setObjectName("lineEdit")
        self.lineEdit_2 = QtWidgets.QLineEdit(self.centralwidget)
        self.lineEdit_2.setGeometry(QtCore.QRect(90, 50, 291, 20))
        self.lineEdit_2.setObjectName("lineEdit_2")
        self.label_2 = QtWidgets.QLabel(self.centralwidget)
        self.label_2.setGeometry(QtCore.QRect(20, 50, 47, 13))
        self.label_2.setObjectName("label_2")
        self.label_3 = QtWidgets.QLabel(self.centralwidget)
        self.label_3.setGeometry(QtCore.QRect(20, 90, 47, 13))
        self.label_3.setObjectName("label_3")
        self.lineEdit_3 = QtWidgets.QLineEdit(self.centralwidget)
        self.lineEdit_3.setGeometry(QtCore.QRect(90, 90, 291, 20))
        self.lineEdit_3.setObjectName("lineEdit_3")
        self.label_4 = QtWidgets.QLabel(self.centralwidget)
        self.label_4.setGeometry(QtCore.QRect(20, 140, 47, 13))
        self.label_4.setObjectName("label_4")
        self.comboBox = QtWidgets.QComboBox(self.centralwidget)
        self.comboBox.setGeometry(QtCore.QRect(90, 140, 291, 22))
        self.comboBox.setObjectName("comboBox")
        self.label_5 = QtWidgets.QLabel(self.centralwidget)
        self.label_5.setGeometry(QtCore.QRect(50, 290, 331, 16))
        self.label_5.setText("")
        self.label_5.setObjectName("label_5")
        self.pushButton = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton.setGeometry(QtCore.QRect(170, 210, 191, 23))
        self.pushButton.setObjectName("pushButton")
        OKNOWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(OKNOWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 426, 21))
        self.menubar.setObjectName("menubar")
        OKNOWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(OKNOWindow)
        self.statusbar.setObjectName("statusbar")
        OKNOWindow.setStatusBar(self.statusbar)

        self.retranslateUi(OKNOWindow)
        QtCore.QMetaObject.connectSlotsByName(OKNOWindow)

    def retranslateUi(self, OKNOWindow):
        _translate = QtCore.QCoreApplication.translate
        OKNOWindow.setWindowTitle(_translate("OKNOWindow", "MainWindow"))
        self.label.setText(_translate("OKNOWindow", "НАЗВАНИЕ:"))
        self.label_2.setText(_translate("OKNOWindow", "ГОД:"))
        self.label_3.setText(_translate("OKNOWindow", "ДЛИНА:"))
        self.label_4.setText(_translate("OKNOWindow", "ЖАНР:"))
        self.pushButton.setText(_translate("OKNOWindow", "ДОБАВИТЬ"))


class MyWidget(QMainWindow, Ui_HomeWindow):
    def __init__(self):
        global asa
        super().__init__()
        self.setupUi(self)
        self.pushButton.clicked.connect(self.info)
        asa = self
        self.run()



    def run(self):
        con = sqlite3.connect('films_db.sqlite')
        cur = con.cursor()
        res = cur.execute("""SELECT DISTINCT 
            films.id as ID, films.title as TITLE, films.year as YEAR, genres.title, films.duration as DURATION
        FROM
            films
        INNER JOIN genres 
            ON films.genre = genres.id;""").fetchall()[::-1]
        cur.close()
        con.close()
        self.tableWidget.setColumnCount(5)
        self.tableWidget.setRowCount(0)
        self.tableWidget.setHorizontalHeaderLabels(['ID', 'Название', 'Год выпуска', 'Жанр', 'Длина'])
        for i, row in enumerate(res):
            self.tableWidget.setRowCount(
                self.tableWidget.rowCount() + 1)
            for j, elem in enumerate(row):
                self.tableWidget.setItem(
                    i, j, QTableWidgetItem(str(elem)))

    def update_tabl(self):
        self.dialog.close()
        con = sqlite3.connect('films_db.sqlite')
        cur = con.cursor()
        res = cur.execute("""SELECT DISTINCT 
            films.id as ID, films.title as TITLE, films.year as YEAR, genres.title, films.duration as DURATION
        FROM
            films
        INNER JOIN genres 
            ON films.genre = genres.id;""").fetchall()[::-1]
        cur.close()
        con.close()

        self.tableWidget.setColumnCount(5)
        self.tableWidget.setRowCount(0)
        self.tableWidget.setHorizontalHeaderLabels(['ID', 'Название', 'Год выпуска', 'Жанр', 'Длина'])
        for i, row in enumerate(res):
            self.tableWidget.setRowCount(
                self.tableWidget.rowCount() + 1)
            for j, elem in enumerate(row):
                self.tableWidget.setItem(
                    i, j, QTableWidgetItem(str(elem)))


    def info(self):
        self.dialog = OKNO()
        self.dialog.show()



class OKNO(QMainWindow, Ui_OKNOWindow):
    def __init__(self):
        super().__init__()
        self.setupUi(self)
        con = sqlite3.connect('films_db.sqlite')
        cur = con.cursor()
        result = cur.execute("""SELECT title FROM genres""").fetchall()
        cur.close()

        con.close()


        res = [i[0] for i in result]
        self.comboBox.addItems(res)
        self.pushButton.clicked.connect(self.sbor)
        self.comboBox.activated.connect(self.handleActivated)
        self.znach = 'комедия'

    def sbor(self):
        self.name = self.lineEdit.text()
        self.year = self.lineEdit_2.text()
        self.dur = self.lineEdit_3.text()
        if self.name == '' or self.year == '' or self.dur == '':
            self.label_5.setText("ОШИБКА В ДАННЫХ")
        else:
            if self.check():
                if not(int(self.dur) < 1 or int(self.year) > 2022 or int(self.year) < 1895):
                    con = sqlite3.connect('films_db.sqlite')
                    cur = con.cursor()
                    cur.execute("""INSERT INTO films(title, year, duration, genre) VALUES(?, ?, ?, ?);""",
                                (self.name, int(self.year), int(self.dur), int(self.znach) + 1))
                    con.commit()
                    con.close()
                    MyWidget.update_tabl(asa)
                    self.close()
                else:
                    self.label_5.setText("ОШИБКА В ДАННЫХ")
            else:
                self.label_5.setText("ОШИБКА В ДАННЫХ")

    def check(self):
        flag = True
        for i in list(self.year):
            if str(i) not in '1234567890':
                flag = False
        for i in list(self.dur):
            if str(i) not in '1234567890':
                flag = False
        return flag

    def handleActivated(self, text):
        self.znach = text


if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = MyWidget()
    ex.show()
    sys.exit(app.exec_())</code></pre>
									</details>
							</article>
				</section>
			</main>
		</div>
		<aside class="layout__active-area">
			<nav class="yd609d--task-group-navigation">
				<ul class="yd609d--task-group-navigation__groups">
						<li class="yd609d--task-group-navigation__group"><span
								class="task-tag task-tag_type_classwork task-tag_size_l yd609d--task-group-navigation__tag"
								tabindex="8"></span>
							<ul class="yd609d--task-group-navigation__tasks">
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25775">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25999">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25715">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25757">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25857">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
							</ul>
						</li>
						<li class="yd609d--task-group-navigation__group"><span
								class="task-tag task-tag_type_homework task-tag_size_l yd609d--task-group-navigation__tag"
								tabindex="8"></span>
							<ul class="yd609d--task-group-navigation__tasks">
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25889">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25982">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25667">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../26003">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link  yd609d--task-group-navigation__link_checked"
											   href="../25830">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
							</ul>
						</li>
						<li class="yd609d--task-group-navigation__group"><span
								class="task-tag task-tag_type_additional task-tag_size_l yd609d--task-group-navigation__tag"
								tabindex="8"></span>
							<ul class="yd609d--task-group-navigation__tasks">
									<li class="yd609d--task-group-navigation__task">
											<a class="yd609d--task-group-navigation__link"
											   href="../25929">
												<div class="indicator indicator_color_grey indicator_size_xs"></div>
											</a>
									</li>
							</ul>
						</li>
				</ul>
			</nav>
		</aside>
	</div>
	<script src="/js/prism.js"></script>
</body>
</html>